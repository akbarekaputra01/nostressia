- name: Push backend folder to HF Space (LFS)
  env:
    HF_TOKEN: ${{ secrets.HF_TOKEN }}
  run: |
    set -e

    # ðŸ”´ WAJIB: nama folder backend di repo GitHub
    BACKEND_DIR="nostressia-backend"

    # ðŸ”´ WAJIB: HF Space kamu
    HF_USER="akbarekaputra01"
    HF_SPACE="nostressia-backend"

    REPO_URL="https://${HF_USER}:${HF_TOKEN}@huggingface.co/spaces/${HF_USER}/${HF_SPACE}.git"

    echo "=== CHECK ROOT DIR ==="
    ls -la

    echo "=== CHECK BACKEND DIR ==="
    test -d "$BACKEND_DIR"
    ls -la "$BACKEND_DIR"

    echo "=== PREP TEMP REPO ==="
    rm -rf /tmp/hf-backend
    mkdir -p /tmp/hf-backend
    rsync -av --delete "${BACKEND_DIR}/" /tmp/hf-backend/

    cd /tmp/hf-backend

    echo "=== INIT GIT ==="
    git init
    git config user.email "actions@github.com"
    git config user.name "github-actions"

    echo "=== INIT LFS ==="
    git lfs install
    git lfs track "*.joblib" "*.pkl" "*.pt" "*.onnx" || true

    git add .gitattributes || true
    git commit -m "Add LFS tracking" || true

    echo "=== COMMIT BACKEND ==="
    git add -A
    git commit -m "Sync backend from GitHub ${GITHUB_SHA}" || echo "No changes"

    git branch -M main
    git remote add origin "$REPO_URL"

    echo "=== PUSH TO HF SPACE ==="
    git push --force origin main
