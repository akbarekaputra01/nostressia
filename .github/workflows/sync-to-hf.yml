name: Sync Backend (BE) to Hugging Face hub

on:
  push:
    branches: [main]
    paths:
      - "nostressia-backend/**"     # <-- ganti sesuai folder BE kamu
      - ".github/workflows/**"      # biar kalau workflow diedit ikut jalan
  workflow_dispatch:

jobs:
  sync-to-hub:
    runs-on: ubuntu-latest

    environment:
      name: Production
      url: https://akbarekaputra01-nostressia-backend.hf.space

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          lfs: true

      - name: Prepare backend-only repo content
        run: |
          set -e
          BACKEND_DIR="Nostressia-Backend"   # <-- ganti ini kalau nama folder BE beda

          # Bersihin workspace target
          rm -rf out
          mkdir -p out

          # Copy hanya folder BE ke folder out (jadi root Space = isi BE)
          rsync -av --delete \
            --exclude ".git" \
            --exclude ".github" \
            "$BACKEND_DIR"/ out/

          # (Opsional) kalau mau pastiin nggak ada file aneh kebawa:
          # find out -name ".DS_Store" -delete

      - name: Push backend-only to Hugging Face Space
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          set -e
          cd out

          git init
          git lfs install

          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

          git add -A
          git commit -m "Sync backend from GitHub (BE only)"

          git remote add space https://akbarekaputra01:$HF_TOKEN@huggingface.co/spaces/akbarekaputra01/Nostressia-Backend
          git branch -M main
          git push --force space main
